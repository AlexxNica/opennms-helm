{"version":3,"sources":["../../../../src/panels/alarm-table/selection_mgr.js"],"names":["SelectionMgr","getRowsInRange","onSelectionChangeCallback","clearSelectedRows","_selectedRows","Set","_lastSelectedRow","undefined","row","exclusiveModifier","rangeModifier","selectedRows","handleSelection","selectedRow","isEqual","Array","from","add","selectionRows","didSelectionChange","rowsToAddToSelection","filter","isRowSelected","selectionRow","rowsToRemoveFromSelection","getSelectedRows","findIndex","length","each","addRowToSelection","rowToAddToSelection"],"mappings":";;;;;;;;;AAAA;;;;;;;;IAEaA,Y,WAAAA,Y;AAEX,wBAAYC,cAAZ,EAA4BC,yBAA5B,EAAuD;AAAA;;AACrD,SAAKC,iBAAL;AACA,SAAKF,cAAL,GAAsBA,cAAtB;AACA,SAAKC,yBAAL,GAAiCA,yBAAjC;AACD;;;;wCAEmB;AAClB,WAAKE,aAAL,GAAqB,IAAIC,GAAJ,EAArB;AACA,WAAKC,gBAAL,GAAwBC,SAAxB;AACD;;;mCAEcC,G,EAAKC,iB,EAAmBC,a,EAAe;AACpD,UAAIC,qBAAJ;AACA,UAAI,CAACD,aAAD,IAAkB,KAAKJ,gBAAL,KAA0BC,SAAhD,EAA2D;AACzD;AACAI,uBAAe,CAACH,GAAD,CAAf;AACD,OAHD,MAGO;AACL;AACA;AACAG,uBAAe,KAAKV,cAAL,CAAoB,KAAKK,gBAAzB,EAA2CE,GAA3C,CAAf;AACD;AACD,WAAKI,eAAL,CAAqBD,YAArB,EAAmCF,iBAAnC;AACD;;;kCAEaD,G,EAAK;AAAA;AAAA;AAAA;;AAAA;AACjB,6BAAwB,KAAKJ,aAA7B,8HAA4C;AAAA,cAAnCS,WAAmC;;AAC1C,cAAI,iBAAEC,OAAF,CAAUD,WAAV,EAAuBL,GAAvB,CAAJ,EAAiC;AAC/B,mBAAO,IAAP;AACD;AACF;AALgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAMjB,aAAO,KAAP;AACD;;;sCAEiB;AAChB,aAAOO,MAAMC,IAAN,CAAW,KAAKZ,aAAhB,CAAP;AACD;;;sCAEiBI,G,EAAK;AACrB,WAAKJ,aAAL,CAAmBa,GAAnB,CAAuBT,GAAvB;AACA,WAAKF,gBAAL,GAAwBE,GAAxB;AACD;;;oCAEeU,a,EAAeT,iB,EAAmB;AAAA;;AAChD,UAAIU,qBAAqB,KAAzB;AACA,UAAI,CAACV,iBAAL,EAAwB;AACtB;AACA,YAAIW,uBAAuB,iBAAEC,MAAF,CAASH,aAAT,EAAwB;AAAA,iBAAgB,CAAC,MAAKI,aAAL,CAAmBC,YAAnB,CAAjB;AAAA,SAAxB,CAA3B;;AAEA;AACA,YAAIC,4BAA4B,iBAAEH,MAAF,CAAS,KAAKI,eAAL,EAAT,EAAiC,uBAAe;AAC9E,iBAAO,iBAAEC,SAAF,CAAYR,aAAZ,EAA2B;AAAA,mBAAgB,iBAAEJ,OAAF,CAAUD,WAAV,EAAuBU,YAAvB,CAAhB;AAAA,WAA3B,IAAmF,CAA1F;AACD,SAF+B,CAAhC;;AAIA,YAAIC,0BAA0BG,MAA1B,GAAmC,CAAvC,EAA0C;AACxC;AACA,eAAKxB,iBAAL;AACA,2BAAEyB,IAAF,CAAOV,aAAP,EAAsB;AAAA,mBAAgB,MAAKW,iBAAL,CAAuBN,YAAvB,CAAhB;AAAA,WAAtB;AACAJ,+BAAqB,IAArB;AACD,SALD,MAKO,IAAIC,qBAAqBO,MAArB,GAA8B,CAAlC,EAAqC;AAC1C;AACA,2BAAEC,IAAF,CAAOR,oBAAP,EAA6B;AAAA,mBAAwB,MAAKS,iBAAL,CAAuBC,mBAAvB,CAAxB;AAAA,WAA7B;AACAX,+BAAqB,IAArB;AACD;AACF,OAnBD,MAmBO;AACL;AACA,yBAAES,IAAF,CAAOV,aAAP,EAAsB,wBAAgB;AACpC,cAAI,CAAC,MAAKI,aAAL,CAAmBC,YAAnB,CAAL,EAAuC;AACrC,kBAAKM,iBAAL,CAAuBN,YAAvB;AACAJ,iCAAqB,IAArB;AACD;AACF,SALD;AAMD;;AAED,UAAIA,sBAAsB,KAAKjB,yBAA/B,EAA0D;AACxD,aAAKA,yBAAL;AACD;AACF","file":"selection_mgr.js","sourcesContent":["import _ from 'lodash';\n\nexport class SelectionMgr {\n\n  constructor(getRowsInRange, onSelectionChangeCallback) {\n    this.clearSelectedRows();\n    this.getRowsInRange = getRowsInRange;\n    this.onSelectionChangeCallback = onSelectionChangeCallback;\n  }\n\n  clearSelectedRows() {\n    this._selectedRows = new Set();\n    this._lastSelectedRow = undefined;\n  }\n\n  handleRowClick(row, exclusiveModifier, rangeModifier) {\n    let selectedRows;\n    if (!rangeModifier || this._lastSelectedRow === undefined) {\n      // No other row was previously selected, use the row that was clicked on\n      selectedRows = [row];\n    } else {\n      // Build the list of rows between the last row that was clicked\n      // and the current row\n      selectedRows = this.getRowsInRange(this._lastSelectedRow, row);\n    }\n    this.handleSelection(selectedRows, exclusiveModifier);\n  }\n\n  isRowSelected(row) {\n    for (let selectedRow of this._selectedRows) {\n      if (_.isEqual(selectedRow, row)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  getSelectedRows() {\n    return Array.from(this._selectedRows);\n  }\n\n  addRowToSelection(row) {\n    this._selectedRows.add(row);\n    this._lastSelectedRow = row;\n  }\n\n  handleSelection(selectionRows, exclusiveModifier) {\n    let didSelectionChange = false;\n    if (!exclusiveModifier) {\n      // Determine the rows we need to add to the selection\n      let rowsToAddToSelection = _.filter(selectionRows, selectionRow => !this.isRowSelected(selectionRow));\n\n      // Determine the rows we need to remove from the selection\n      let rowsToRemoveFromSelection = _.filter(this.getSelectedRows(), selectedRow => {\n        return _.findIndex(selectionRows, selectionRow => _.isEqual(selectedRow, selectionRow)) < 0;\n      });\n\n      if (rowsToRemoveFromSelection.length > 0) {\n        // Clear everything and add all the selected rows\n        this.clearSelectedRows();\n        _.each(selectionRows, selectionRow => this.addRowToSelection(selectionRow));\n        didSelectionChange = true;\n      } else if (rowsToAddToSelection.length > 0) {\n        // Add the selected rows\n        _.each(rowsToAddToSelection, rowToAddToSelection =>  this.addRowToSelection(rowToAddToSelection));\n        didSelectionChange = true;\n      }\n    } else {\n      // Add the rows to the current selection\n      _.each(selectionRows, selectionRow => {\n        if (!this.isRowSelected(selectionRow)) {\n          this.addRowToSelection(selectionRow);\n          didSelectionChange = true;\n        }\n      });\n    }\n\n    if (didSelectionChange && this.onSelectionChangeCallback) {\n      this.onSelectionChangeCallback();\n    }\n  }\n}\n"]}