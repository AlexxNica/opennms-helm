{"version":3,"sources":["../../../../src/datasources/fault-ds/ui/Controls.js"],"names":["_","Restriction","Query","Control","title","icon","query","clause","Error","RemoveControl","removeClause","root","getSize","parentQuery","undefined","parentClause","find","clauses","restriction","length","asRestrictionDTO","AddControl","index","indexOf","createNewEmptyClause","AddNestedControl","createNewEmptyNestedClause"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAOA,a;;AACCC,uB,gBAAAA,W;;AACAC,iB,UAAAA,K;;;;;;;;;;;;;;;;;;;;;AAMFC,mB;AAEF,iCAAYC,KAAZ,EAAmBC,IAAnB,EAAyB;AAAA;;AACrB,yBAAKD,KAAL,GAAaA,KAAb;AACA,yBAAKC,IAAL,GAAYA,IAAZ;AACH;;;;2CAEMC,K,EAAOC,M,EAAQ;AAClB,8BAAM,IAAIC,KAAJ,CAAU,oCAAV,CAAN;AACH;;;2CAEMF,K,EAAOC,M,EAAQ;AAClB,8BAAM,IAAIC,KAAJ,CAAU,oCAAV,CAAN;AACH;;;;;;qCAMQC,a;;;AACT,yCAAc;AAAA;;AAAA,yIACJ,eADI,EACa,UADb;AAEb;;;;2CAEMH,K,EAAOC,M,EAAQ;AAClBD,8BAAMI,YAAN,CAAmBH,MAAnB;AACA,4BAAID,MAAMK,IAAN,KAAe,KAAf,IAAwBL,MAAMM,OAAN,OAAoB,CAA5C,IAAiDN,MAAMO,WAAN,KAAsBC,SAA3E,EAAsF;AAClF,gCAAMC,eAAef,EAAEgB,IAAF,CAAOV,MAAMO,WAAN,CAAkBI,OAAzB,EAAkC,kBAAU;AAC7D,uCAAOV,OAAOW,WAAP,IAAsBZ,KAA7B;AACH,6BAFoB,CAArB;AAGAA,kCAAMO,WAAN,CAAkBH,YAAlB,CAA+BK,YAA/B;AACH;AACJ;;;2CAEMT,K,EAAOC,M,EAAQ;AAClB,4BAAIA,OAAOW,WAAP,YAA8BhB,KAAlC,EAAyC;AACrC,mCAAO,KAAP;AACH;AACD,4BAAII,MAAMK,IAAN,KAAe,IAAnB,EAAyB;AACrB,mCAAOL,MAAMW,OAAN,CAAcE,MAAd,GAAuB,CAAvB,IAA4BZ,OAAOW,WAAP,CAAmBE,gBAAnB,OAA0C,IAA7E;AACH;AACD,+BAAO,IAAP;AACH;;;;cAvB8BjB,O;;;;kCA6BtBkB,U;;;AAET,sCAAc;AAAA;;AAAA,mIACJ,gBADI,EACc,SADd;AAEb;;;;2CAEMf,K,EAAOC,M,EAAQ;AAClB,4BAAMe,QAAQhB,MAAMW,OAAN,CAAcM,OAAd,CAAsBhB,MAAtB,IAAgC,CAA9C;AACAD,8BAAMkB,oBAAN,CAA2BF,KAA3B;AACH;;;2CAEMhB,K,EAAOC,M,EAAQ;AAClB,4BAAIA,OAAOW,WAAP,YAA8BhB,KAAlC,EAAyC;AACrC,mCAAO,KAAP;AACH;AACD,+BAAO,IAAP;AACH;;;;cAhB2BC,O;;;;wCAsBnBsB,gB;;;AACT,4CAAc;AAAA;;AAAA,+IACJ,mBADI,EACiB,SADjB;AAEb;;;;2CAEMnB,K,EAAOC,M,EAAQ;AAClB,4BAAMe,QAAQhB,MAAMW,OAAN,CAAcM,OAAd,CAAsBhB,MAAtB,IAAgC,CAA9C;AACAD,8BAAMoB,0BAAN,CAAiCJ,KAAjC;AACH;;;2CAEMhB,K,EAAOC,M,EAAQ;AAClB,+BAAOD,MAAMK,IAAN,KAAe,IAAf,IAAuB,EAAEJ,OAAOW,WAAP,YAA8BhB,KAAhC,CAA9B;AACH;;;;cAZiCC,O","file":"Controls.js","sourcesContent":["import _ from 'lodash';\nimport {Restriction} from './Restriction';\nimport {Query} from './Query';\n\n\n/**\n * Parent class of all controls.\n */\nclass Control {\n\n    constructor(title, icon) {\n        this.title = title;\n        this.icon = icon;\n    }\n\n    action(query, clause) {\n        throw new Error(\"Method action(...) not implemented\");\n    }\n\n    filter(query, clause) {\n        throw new Error(\"Method filter(...) not implemented\");\n    }\n}\n\n/**\n * Control to remove the current clause from the current query.\n */\nexport class RemoveControl extends Control {\n    constructor() {\n        super(\"Remove clause\", 'fa-minus');\n    }\n\n    action(query, clause) {\n        query.removeClause(clause);\n        if (query.root === false && query.getSize() === 0 && query.parentQuery !== undefined) {\n            const parentClause = _.find(query.parentQuery.clauses, clause => {\n                return clause.restriction == query\n            });\n            query.parentQuery.removeClause(parentClause);\n        }\n    }\n\n    filter(query, clause) {\n        if (clause.restriction instanceof Query) {\n            return false;\n        }\n        if (query.root === true) {\n            return query.clauses.length > 1 || clause.restriction.asRestrictionDTO() !== null;\n        }\n        return true;\n    }\n}\n\n/**\n * Control to add a new clause to the current query.\n */\nexport class AddControl extends Control {\n\n    constructor() {\n        super('Add new clause', 'fa-plus');\n    }\n\n    action(query, clause) {\n        const index = query.clauses.indexOf(clause) + 1;\n        query.createNewEmptyClause(index);\n    }\n\n    filter(query, clause) {\n        if (clause.restriction instanceof Query) {\n            return false;\n        }\n        return true;\n    }\n}\n\n/**\n * Control to add a new nested clause to the current query.\n */\nexport class AddNestedControl extends Control {\n    constructor() {\n        super('Add nested clause', 'fa-file', );\n    }\n\n    action(query, clause) {\n        const index = query.clauses.indexOf(clause) + 1;\n        query.createNewEmptyNestedClause(index);\n    }\n\n    filter(query, clause) {\n        return query.root === true && !(clause.restriction instanceof Query);\n    }\n}"]}