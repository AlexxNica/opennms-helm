{"version":3,"sources":["../../../src/panels/alarm-table/renderer.js"],"names":["_","moment","kbn","Model","TableRenderer","panel","table","isUtc","sanitize","initColumns","formatters","colorState","colIndex","columns","length","column","title","text","i","styles","style","regex","stringToJsRegex","pattern","match","alias","replace","createColumnFormatter","v","undefined","isArray","join","escape","defaultCellFormatter","type","date","utc","format","dateFormat","valueFormatter","valueFormats","unit","isString","colorMode","getColorForValue","decimals","value","columnIndex","addWidthHack","formatColumnValue","classes","cell","widthHack","hidden","width","clip","stylesAsString","reduce","map","val","key","memo","page","pageSize","startPos","endPos","Math","min","rows","html","y","row","cellHtml","rowStyle","rowClass","source","meta","alarm","ticketerConfig","severity","label","toLowerCase","severityIcons","icon","getIconForSeverity","id","renderCell","actions","Menu","withGroup","Group","withItem","MenuItem","ackTime","index","Severities","CLEARED","NORMAL","CRITICAL","withVisibility","enabled","troubleTicketState","TroubleTicketStates","CREATE_FAILED","troubleTicket","OPEN","CLOSE_FAILED","render","new_row","push","thresholds","colors","first","items","visibilityFn","itemOrMenu","group","getVisibleItems","visibleItems","filter","item","isVisible","renderedItems","rendered","action"],"mappings":"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","file":"renderer.js","sourcesContent":["import _ from 'lodash';\nimport moment from 'moment';\nimport kbn from 'app/core/utils/kbn';\nimport {Model} from '../../opennms';\n\nexport class TableRenderer {\n\n  constructor(panel, table, isUtc, sanitize) {\n    this.panel = panel;\n    this.table = table;\n    this.isUtc = isUtc;\n    this.sanitize = sanitize;\n\n    this.initColumns();\n  }\n\n  setTable(table) {\n    this.table = table;\n\n    this.initColumns();\n  }\n\n  initColumns() {\n    this.formatters = [];\n    this.colorState = {};\n\n    for (let colIndex = 0; colIndex < this.table.columns.length; colIndex++) {\n      let column = this.table.columns[colIndex];\n      column.title = column.text;\n\n      for (let i = 0; i < this.panel.styles.length; i++) {\n        let style = this.panel.styles[i];\n\n        let regex = kbn.stringToJsRegex(style.pattern);\n        if (column.text.match(regex)) {\n          column.style = style;\n\n          if (style.alias) {\n            column.title = column.text.replace(regex, style.alias);\n          }\n\n          break;\n        }\n      }\n\n      this.formatters[colIndex] = this.createColumnFormatter(column);\n    }\n  }\n\n  static getColorForValue(value, style) {\n    if (!style.thresholds) {\n      return null;\n    }\n\n    for (let i = style.thresholds.length; i > 0; i--) {\n      if (value >= style.thresholds[i - 1]) {\n        return style.colors[i];\n      }\n    }\n    return _.first(style.colors);\n  }\n\n  defaultCellFormatter(v, style) {\n    if (v === null || v === void 0 || v === undefined) {\n      return '';\n    }\n\n    if (_.isArray(v)) {\n      v = v.join(', ');\n    }\n\n    if (style && style.sanitize) {\n      return this.sanitize(v);\n    } else {\n      return _.escape(v);\n    }\n  }\n\n  createColumnFormatter(column) {\n    if (!column.style) {\n      return this.defaultCellFormatter;\n    }\n\n    if (column.style.type === 'hidden') {\n      return v => {\n        return undefined;\n      };\n    }\n\n    if (column.style.type === 'date') {\n      return v => {\n        if (v === undefined || v === null) {\n          return '-';\n        }\n\n        if (_.isArray(v)) {\n          v = v[0];\n        }\n        let date = moment(v);\n        if (this.isUtc) {\n          date = date.utc();\n        }\n        return date.format(column.style.dateFormat);\n      };\n    }\n\n    if (column.style.type === 'number') {\n      let valueFormatter = kbn.valueFormats[column.unit || column.style.unit];\n\n      return v => {\n        if (v === null || v === void 0) {\n          return '-';\n        }\n\n        if (_.isString(v)) {\n          return this.defaultCellFormatter(v, column.style);\n        }\n\n        if (column.style.colorMode) {\n          this.colorState[column.style.colorMode] = TableRenderer.getColorForValue(v, column.style);\n        }\n\n        return valueFormatter(v, column.style.decimals, null);\n      };\n    }\n\n    return (value) => {\n      return this.defaultCellFormatter(value, column.style);\n    };\n  }\n\n  formatColumnValue(colIndex, value) {\n    return this.formatters[colIndex] ? this.formatters[colIndex](value) : value;\n  }\n\n  renderCell(columnIndex, value, addWidthHack = false) {\n    value = this.formatColumnValue(columnIndex, value);\n    let column = this.table.columns[columnIndex];\n    let styles = {};\n    let classes = [];\n\n    if (this.colorState.cell) {\n      styles['background-color'] = this.colorState.cell;\n      styles['color'] = 'white';\n      this.colorState.cell = null;\n    } else if (this.colorState.value) {\n      styles['color'] = this.colorState.value;\n      this.colorState.value = null;\n    }\n\n    // because of the fixed table headers css only solution\n    // there is an issue if header cell is wider the cell\n    // this hack adds header content to cell (not visible)\n    let widthHack = '';\n    if (addWidthHack) {\n      widthHack = '<div class=\"table-panel-width-hack\">' + column.title + '</div>';\n    }\n\n    if (value === undefined) {\n      styles['display'] = 'none';\n      column.hidden = true;\n    } else {\n      column.hidden = false;\n    }\n\n    if (column.style.width) {\n      styles['width'] = column.style.width;\n      if (column.style.clip) {\n        styles['max-width'] = column.style.width;\n        styles['white-space'] = 'nowrap';\n      }\n    }\n\n    if (column.style.clip) {\n      styles['overflow'] = 'hidden';\n      styles['text-overflow'] = 'ellipsis';\n    }\n\n    let stylesAsString = 'style=\"' + _.reduce(_.map(styles, function(val, key){ return key + ':' + val; }),\n      (memo, style) => {\n        if (memo.length > 0) {\n          return memo + '; ' + style;\n        } else {\n          return style;\n        }\n      }, '') + '\"';\n\n    return '<td ' + stylesAsString + '>' + value + widthHack + '</td>';\n  }\n\n  static getIconForSeverity(severity) {\n    let icon = 'ion-help';\n    switch(severity) {\n      case 'indeterminate':\n        icon = 'ion-help';\n        break;\n      case 'warning':\n        icon = 'ion-alert-circled';\n        break;\n      case 'minor':\n        icon = 'ion-flash';\n        break;\n      case 'major':\n        icon = 'ion-flame';\n        break;\n      case 'critical':\n        icon = 'ion-nuclear';\n        break;\n      case 'normal':\n        icon = 'ion-leaf';\n        break;\n      case 'cleared':\n        icon = 'ion-checkmark-circled';\n        break;\n    }\n    return icon;\n  }\n\n\n  render(page) {\n    let pageSize = this.panel.pageSize || 100;\n    let startPos = page * pageSize;\n    let endPos = Math.min(startPos + pageSize, this.table.rows.length);\n    let html = \"\";\n\n    for (let y = startPos; y < endPos; y++) {\n      let row = this.table.rows[y];\n      let cellHtml = '';\n      let rowStyle = '';\n      let rowClass = '';\n\n      let source = row.meta.source.replace(/'/g, '\\\\\\'');\n      let alarm = row.meta.alarm;\n      let ticketerConfig = row.meta.ticketerConfig;\n      let severity = alarm.severity.label.toLowerCase();\n\n      if (this.panel.severityIcons) {\n        let icon = TableRenderer.getIconForSeverity(severity);\n        cellHtml += `<td ng-click=\"ctrl.alarmDetails('${source}', ${alarm.id})\" class=\"severity-icon text-center\"><i class=\"icon ${icon}\"></i></td>`;\n      }\n\n      for (let i = 0; i < this.table.columns.length; i++) {\n        cellHtml += this.renderCell(i, row[i], y === startPos);\n      }\n\n      if (this.panel.actions) {\n        cellHtml += `<td>`;\n        cellHtml += new Menu()\n            .withGroup(\n                new Group().withItem(new MenuItem(\"Details\", `ctrl.alarmDetails('${source}', ${alarm.id})`))\n            )\n            .withGroup(\n                new Group()\n                    .withItem(new MenuItem(\"Acknowledge\", `ctrl.acknowledgeAlarm('${source}', ${alarm.id})`, () => alarm.ackTime === void 0))\n                    .withItem(new MenuItem(\"Unacknowledge\", `ctrl.unacknowledgeAlarm('${source}', ${alarm.id})`, () => alarm.ackTime))\n                    .withItem(new MenuItem(\"Escalate\", `ctrl.escalateAlarm('${source}', ${alarm.id})`, () => alarm.severity.index == Model.Severities.CLEARED.index || alarm.severity.index >= Model.Severities.NORMAL.index && alarm.severity.index < Model.Severities.CRITICAL.index))\n                    .withItem(new MenuItem(\"Clear\", `ctrl.clearAlarm('${source}', ${alarm.id})`, () => alarm.severity.index >= Model.Severities.NORMAL.index && alarm.severity.index <= Model.Severities.CRITICAL.index))\n            )\n            .withGroup(\n                new Group()\n                    .withVisibility(() => ticketerConfig && ticketerConfig.enabled)\n                    .withItem(new MenuItem(\"Create Ticket\", `ctrl.createTicketForAlarm('${source}', ${alarm.id})`, () => !alarm.troubleTicketState || alarm.troubleTicketState === Model.TroubleTicketStates.CREATE_FAILED))\n                    .withItem(new MenuItem(\"Update Ticket\", `ctrl.updateTicketForAlarm('${source}', ${alarm.id})`, () => alarm.troubleTicketState && alarm.troubleTicket))\n                    .withItem(new MenuItem(\"Close Ticket\", `ctrl.closeTicketForAlarm('${source}', ${alarm.id})`, () => alarm.troubleTicketState && (alarm.troubleTicketState === Model.TroubleTicketStates.OPEN || alarm.troubleTicketState == Model.TroubleTicketStates.CLOSE_FAILED)))\n            ).render();\n        cellHtml += `</td>`;\n      }\n\n      if (this.colorState.row) {\n        rowStyle = ' style=\"background-color:' + this.colorState.row + ';color: white\"';\n        this.colorState.row = null;\n      }\n\n      if (this.panel.severity) {\n        rowClass = ' class=\"' + severity + '\"';\n      }\n\n      html += '<tr ' + rowStyle + rowClass + '>' + cellHtml + '</tr>';\n    }\n\n    return html;\n  }\n\n  render_values() {\n    let rows = [];\n\n    for (let y = 0; y < this.table.rows.length; y++) {\n      let row = this.table.rows[y];\n      let new_row = [];\n      for (let i = 0; i < this.table.columns.length; i++) {\n        new_row.push(this.formatColumnValue(i, row[i]));\n      }\n      rows.push(new_row);\n    }\n    return {\n      columns: this.table.columns,\n      rows: rows,\n    };\n  }\n}\n\nclass Group {\n  constructor() {\n    this.items = [];\n    this.visibilityFn = () => true;\n  }\n\n  withVisibility(visibilityFn) {\n    this.visibilityFn = visibilityFn;\n    return this;\n  }\n\n  withItem(itemOrMenu) {\n    this.items.push(itemOrMenu);\n    return this;\n  }\n\n  withGroup(group) {\n    this.withItem(group);\n      return this;\n  }\n\n  isVisible() {\n    if (this.visibilityFn()) {\n      return this.getVisibleItems().length >= 1;\n    }\n    return false;\n  }\n\n  getVisibleItems() {\n    const visibleItems = _.filter(this.items, item => {\n        return item.isVisible();\n    });\n    return visibleItems;\n  }\n\n  render() {\n    const visibleItems = _.filter(this.items, item => {\n      return item.isVisible();\n    });\n\n    const renderedItems = _.map(visibleItems, item => {\n      return item.render();\n    });\n    return renderedItems.join('');\n  }\n}\n\nclass Menu extends Group {\n\n    constructor() {\n        super();\n    }\n\n    render() {\n        let html = '<div class=\"gf-form gf-form-no-margin\">';\n        html += '<label class=\"gf-form-label gf-smaller-form-label dropdown\">';\n        html += '<a class=\"pointer dropdown-toggle\" data-toggle=\"dropdown\" tabindex=\"1\"><i class=\"fa fa-bars\"></i></a>';\n        html += '<ul class=\"dropdown-menu dropdown-menu-with-smaller-form-label pull-right\"role=\"menu\">';\n\n        const visibleItems = this.getVisibleItems();\n        html += _.map(visibleItems, (item, index) => {\n            let rendered = item.render();\n            if (index < visibleItems.length -1) {\n              rendered += '<li class=\"divider\"></li>';\n            }\n            return rendered;\n        }).join('');\n\n        html += '</ul></label></div>';\n        return html;\n    }\n\n}\n\nclass MenuItem {\n  constructor(label, action, visibilityFn) {\n    this.label = label;\n    this.action = action;\n    this.visibilityFn = visibilityFn;\n    if (!visibilityFn) {\n        this.visibilityFn = () => true;\n    }\n  }\n\n  isVisible() {\n    return this.visibilityFn();\n  }\n\n  render() {\n    return '<li role=\"menuitem\"><a tabindex=\"1\" ng-click=\"' + this.action + '\">' + this.label + '</a></li>';\n  }\n}"]}